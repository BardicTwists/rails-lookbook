#!/usr/bin/env node

const fs = require("fs");

const options = require("command-line-args")([
  { name: "name", type: String },
  { name: "base", type: String },
  { name: "accent", type: String },
]);

const themeConfig = require("../theme.config")(options);

const themeCSS = generateThemeCSS(options);
write(
  `./app/assets/lookbook/css/themes/${
    options.name ? options.name : "default"
  }.css`,
  themeCSS
);

// Tailwind classes

const tailwindJSON = generateTailwindJSON();
write("./theme.json", tailwindJSON);

// Utils

function generateThemeCSS(options) {
  const cssThemeLines = [options.name ? `.theme-${options.name} {` : ":root {"];
  Object.keys(themeConfig).forEach((key) => {
    cssThemeLines.push(`  --lookbook-${kebabCase(key)}: ${themeConfig[key]};`);
  });
  cssThemeLines.push("}");
  return cssThemeLines.join("\n");
}

function generateTailwindJSON() {
  const theme = { lookbook: {} };
  Object.keys(themeConfig).forEach((key) => {
    theme.lookbook[kebabCase(key)] = `var(--lookbook-${kebabCase(key)})`;
  });
  return JSON.stringify(theme);
}

function write(path, content) {
  try {
    fs.writeFileSync(path, content);
  } catch (err) {
    console.error(err);
    process.exit(1);
  }
}

function kebabCase(str) {
  return str.replace(/([a-z0-9])([A-Z])/g, "$1-$2").toLowerCase();
}
